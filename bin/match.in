#!/bin/sh

. idioms

usage() { die "usage: %s [-EFa] PATTERN STRING...\n" "${0##*/}"; }

unset GREP_OPTIONS

all=true
any=
pattern_type=

while getopts :EFa arg >/dev/null 2>&1; do
    case "${arg}" in
        E)
            pattern_type=-E
            ;;
        F)
            pattern_type=-F
            ;;
        a)
            all=
            any=true
            ;;
        -)
            break
            ;;
        ?)
            error "unknown argument -- %s\n" "${OPTARG}"
            usage
            ;;

    esac
done
shift $((OPTIND - 1))

[ $# -gt 0 ] || usage

pattern="${1}"; shift

test $(printf '%s\n' "$@" | grep ${pattern_type} -c ${all:+-v} -- "${pattern}") ${all:+-eq 0}${any:+-ne 0} || exit 1

